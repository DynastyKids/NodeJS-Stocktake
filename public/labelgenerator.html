<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label Generator - Stock-take Electron</title>
    <link href="/library/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<div class="container">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Stock-take Electron</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="index.html"><i class="fa-solid fa-house"></i>Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="fa-solid fa-tags"></i>Generate Labels</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fa-solid fa-qrcode"></i>Scan QR Code</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"><i class="fa-regular fa-keyboard"></i>Manual Input</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <h1>Label Generator</h1>

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Label Generator</li>
            </ol>
        </nav>

        <div id="toastDiv" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">Product data has fetched successfully.</div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row mb-3">
                <div class="col-sm-3 col-10">
                    <input type="text" class="form-control" placeholder="Purchase Order NO.">
                </div>
                <div class="col-sm-1 col-2">
                    <button class="btn btn-info" id="table_addRow"><i class="fa-solid fa-plus"></i></button>
                </div>
            </div>
            <table class="table">
                <thead><tr>
                    <th class="rowid d-none d-sm-table-cell">No.</th>
                    <th class="d-inline-block d-sm-table-cell">Product Name</th>
                    <th class="d-inline-block d-sm-table-cell">Quantity</th>
                    <th class="d-inline-block d-sm-table-cell">Unit</th>
                    <th class="d-inline-block d-sm-table-cell">Expire date</th>
                    <th class="d-none d-sm-table-cell">Copies</th>
                    <th class="d-inline-block d-sm-table-cell"></th>
                </tr></thead>
                <tbody>
                </tbody>
            </table>
            <button class="btn btn-primary" id="table_submit">Submit</button>
        </div>
        <datalist id="productSuggestions"></datalist>
        <datalist id="unitSuggestions">
            <option value="bag"></option>
            <option value="bottle"></option>
            <option value="box"></option>
            <option value="carton"></option>
            <option value="piece"></option>
            <option value="roll"></option>
            <option value="unit"></option>
            <option value="pallet"></option>
            <option value="skid"></option>
        </datalist>
    </div>
</div>
<script src="/library/jquery-3.7.1.min.js"></script>
<script src="/library/bootstrap.bundle.min.js"></script>
<script src="/library/axios.min.js"></script>
<script>
    let rowNumber = 1
    document.addEventListener("DOMContentLoaded",function (ev){
        console.log("DOM content Loaded")
        var toast = document.querySelector("#toastDiv")
        axios.get('/api/v1/products', true)
            .then(function (response) {
                console.log(response)
                document.querySelector("#toastDiv .toast-body").innerText = "Product list has fetched successfully"
                document.querySelector("#toastDiv").classList.add("bg-success");
                document.querySelector("#toastDiv").classList.remove("bg-warning");
                console.log(response.data,Array.isArray(response.data.data));
                if(Array.isArray(response.data.data)){
                    response.data.data.forEach(eachItem =>{
                        $("#productSuggestions").append(`<option value="${eachItem.productCode}">${eachItem.description}</option>`);
                    });
                    (new bootstrap.Toast(toast)).show();
                }
            })
            .catch(function (response) {
                document.querySelector("#toastDiv .toast-body").innerText = "There are some problem encountered when fetching product lists"
                document.querySelector("#toastDiv").classList.add("bg-warning");
                document.querySelector("#toastDiv").classList.remove("bg-success");
                (new bootstrap.Toast(toast)).show();
                console.error(response);
            })
    });

    document.querySelector("#table_addRow").addEventListener("click",function (ev){
        var newRow = `
            <tr><td class="rowid d-none d-sm-table-cell">${rowNumber}</td>
            <td class="d-inline-block d-sm-table-cell"><input type="text" list="productSuggestions" class="form-control" placeholder="Select / Enter a product name"></td>
            <td class="d-inline-block d-sm-table-cell"><input type="number" min="0" size="4" class="form-control" placeholder="Enter the quantity"></td>
            <td class="d-inline-block d-sm-table-cell"><input type="text" size="10" list="unitSuggestions" class="form-control" placeholder="Select unit"></td>
            <td class="d-inline-block d-sm-table-cell"><input type="date" class="form-control"></td>
            <td class="d-none d-sm-table-cell"><input type="number" size="5" class="form-control" min="0"></td>
            <td class="d-inline-block d-sm-table-cell"><button class="btn btn-danger deleteRow"><i class="fa-solid fa-trash"></i></button></td>
            </tr>
        `
        rowNumber += 1;
        $('table tbody').append(newRow);
    })

    $('table tbody').on('click', '.deleteRow', function () {
        rowNumber -= 1;
        let currentRow = 1;
        $(this).closest('tr').remove();

        document.querySelectorAll(".rowid").forEach(eachRow => {
            eachRow.innerText = currentRow;
            currentRow += 1;
        })
    });

    document.querySelector("#table_submit").addEventListener("click",function(ev){
    //     Submit部分需要引用Chrome插件项目中的JSPDF，生成PDF后在新窗口回弹给用户，以便用户打印label
    //     新增部分：同时给予用户选择是否添加到数据库，如果选是则开始跳转页面处理（POST请求转发label信息），新页面中弹出modal处理
    })
</script>
<style>
    @media (max-width: 576px) { /* For small devices */
        .table thead th.d-block,
        .table tbody td.d-block {
            display: block;
            width: 100%;
            box-sizing: border-box;
        }
    }
</style>
</body>
</html>